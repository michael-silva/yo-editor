<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../sortable-list/sortable-list.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../paper-styles/paper-styles.html">
<link rel="import" href="./yo-editor-item.html">

<dom-module id="yo-editor">
    <template>
        <style>
            :host {
                display: block;
            }

            .tab {
                padding: 10px;
                display: inline-block;
            }

            .tab:hover,
            .tab.active {
                background-color: var(--yo-editor-tab-active,  var(--paper-grey-300));
            }
        </style>
        <sortable-list>
            <template is="dom-repeat" items="{{items}}">
                <a class="tab" href="#" on-click="_changePage">{{_getItemTitle(item)}}</a>
            </template>
        </sortable-list>
        <iron-pages selected="{{_current}}">
            <template is="dom-repeat" items="{{items}}">
                <div class="page">
                    <yo-editor-item images="{{item.images}}" links="{{item.links}}" texts="{{item.texts}}" items="{{item.items}}"></yo-editor-item>
                </div>
            </template>
        </iron-pages>
    </template>

    <script>
        /**
         * `yo-editor`
         * An generic html elements editor
         *
         * @customElement
         * @polymer
         * @demo demo/index.html
         */
        class YoEditor extends Polymer.Element {
            static get is() { return 'yo-editor'; }
            static get properties() {
                return {
                    items: {
                        type: Array,
                        value: []
                    }
                };
            }

            _changePage(e) {
                if (this._target) 
                    this._target.classList.remove('active');

                this._target = e.target;
                this._current = e.model.index;

                this._target.classList.add('active');
            }

            _getItemTitle(item) {
                let title = item.texts || item.links;
                
                if (!title) title = item.images[0].src;
                else title = title[0].text;

                return title.substring(0, 17) + '...';
            }

            constructor() {
                super();
                this._current = 0;
            }

            connectedCallback() {
                super.connectedCallback();
            }

            getItems() {
                this.root.querySelectorAll('yo-editor-item').map(item => item.getItem());
            }
        }

        window.customElements.define(YoEditor.is, YoEditor);
    </script>
</dom-module>